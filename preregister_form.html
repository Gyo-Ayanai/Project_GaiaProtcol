<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‰∫ãÂâçÁôªÈå≤ - GaiaProtocol</title>
    <link rel="stylesheet" href="style.css" />

    <!-- ‚úÖ PlayFab SDK -->
    <script src="https://cdn.jsdelivr.net/npm/playfab-sdk/Scripts/PlayFab.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/playfab-sdk/Scripts/PlayFabClientApi.js"></script>

    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: radial-gradient(circle at center, #0a0a1a, #000);
        color: #fff;
        text-align: center;
        padding: 30px;
      }

      h1 {
        margin-bottom: 10px;
        color: #88f7ff;
      }

      p {
        color: #ccc;
        margin-bottom: 20px;
      }

      form {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 10px;
        display: inline-block;
        text-align: left;
        width: 300px;
      }

      input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: none;
        border-radius: 5px;
        outline: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-size: 15px;
      }

      input::placeholder {
        color: #aaa;
      }

      button {
        background: linear-gradient(90deg, #00c3ff, #0078ff);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 15px;
        width: 100%;
      }

      button:hover {
        background: linear-gradient(90deg, #00eaff, #0090ff);
      }

      footer {
        margin-top: 50px;
        color: #555;
      }

      .password-box {
        position: relative;
      }

      .password-box input {
        width: 100%;
        padding-right: 50px;
      }

      #togglePassword {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: #aaa;
        font-size: 14px;
        cursor: pointer;
      }

      #togglePassword:hover {
        color: #fff;
      }

      @media screen and (max-width: 600px) {
        form {
          width: 85%;
        }
      }
    </style>
  </head>

  <body>
    <main>
      <h1>„Ç¢„Ç´„Ç¶„É≥„Éà‰∫ãÂâçÁôªÈå≤</h1>
      <p>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ„ÄÅ„É¶„Éº„Ç∂„ÉºÂêç„ÄÅ„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>

      <form id="registerForm">
        <input type="email" id="email" placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ" required /><br />
        <input type="text" id="username" placeholder="„É¶„Éº„Ç∂„ÉºÂêç" required /><br />

        <div class="password-box">
          <input
            type="password"
            id="password"
            placeholder="„Éë„Çπ„ÉØ„Éº„ÉâÔºà6ÊñáÂ≠ó‰ª•‰∏äÔºâ"
            required
          />
          <button type="button" id="togglePassword">Ë°®Á§∫</button>
        </div>

        <input
          type="password"
          id="confirmPassword"
          placeholder="„Éë„Çπ„ÉØ„Éº„ÉâÔºàÁ¢∫Ë™çÁî®Ôºâ"
          required
        /><br />

        <button type="submit">ÁôªÈå≤„Åô„Çã</button>
      </form>

      <p id="result" style="margin-top: 30px; color: #f0a500"></p>
    </main>

    <footer>
      <p>¬© 2025 GaiaProtocol</p>
    </footer>

    <script>
      const titleId = "1FEC7E";
      const web3formsKey = "96cfe88e-9989-49d8-b3b7-3c4d88fb821c";
      PlayFab.settings.titleId = titleId;

      // üëÅ „Éë„Çπ„ÉØ„Éº„ÉâË°®Á§∫Âàá„ÇäÊõø„Åà
      document.getElementById("togglePassword").addEventListener("click", () => {
        const pw = document.getElementById("password");
        pw.type = pw.type === "password" ? "text" : "password";
        document.getElementById("togglePassword").textContent =
          pw.type === "text" ? "ÈùûË°®Á§∫" : "Ë°®Á§∫";
      });

      // üîÅ ÁôªÈå≤Âá¶ÁêÜ
      document
        .getElementById("registerForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value.trim();
          const username = document.getElementById("username").value.trim();
          const password = document.getElementById("password").value;
          const confirmPassword = document.getElementById("confirmPassword").value;
          const result = document.getElementById("result");

          if (password !== confirmPassword) {
            result.innerText = "„Éë„Çπ„ÉØ„Éº„Éâ„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì„ÄÇ";
            return;
          }
          if (password.length < 6) {
            result.innerText = "„Éë„Çπ„ÉØ„Éº„Éâ„ÅØ6ÊñáÂ≠ó‰ª•‰∏ä„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ";
            return;
          }

          result.innerText = "‚è≥ ÁôªÈå≤‰∏≠‚Ä¶";

          PlayFabClientSDK.RegisterPlayFabUser(
            {
              Email: email,
              Password: password,
              Username: username,
              RequireBothUsernameAndEmail: true,
            },
            function (success) {
              result.innerText = "‚úÖ ÁôªÈå≤ÊàêÂäüÔºÅ„É≠„Ç∞„Ç§„É≥‰∏≠...";

              // ‚ë° ÁôªÈå≤ÂÆå‰∫ÜÂæå„Å´„É≠„Ç∞„Ç§„É≥
              PlayFabClientSDK.LoginWithEmailAddress(
                {
                  Email: email,
                  Password: password,
                },
                function (loginResponse) {
                  result.innerText = "üì¶ „Éá„Éº„Çø‰øùÂ≠ò‰∏≠...";

                  // ‚ë¢ „Éá„Éº„ÇøÁôªÈå≤
                  PlayFabClientSDK.UpdateUserData(
                    {
                      Data: {
                        pre_registered: "true",
                        register_date: new Date().toISOString(),
                      },
                    },
                    async function () {
                      result.innerText = "üìß „É°„Éº„É´ÈÄÅ‰ø°‰∏≠...";

                      // ‚ë£ „É°„Éº„É´ÈÄÅ‰ø°
                      try {
                        await fetch("https://api.web3forms.com/submit", {
                          method: "POST",
                          headers: { "Content-Type": "application/json" },
                          body: JSON.stringify({
                            access_key: web3formsKey,
                            subject:
                              "„ÄêGaiaProtocolÈÅãÂñ∂„Äë‰∫ãÂâçÁôªÈå≤„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ",
                            from_name: "GaiaProtocol",
                            to: email,
                            message: `„Åì„Çì„Å´„Å°„ÅØ ${username} „Åï„ÇìÔºÅ\n\n„ÄéGaia Protocol„Äè„Å´‰∫ãÂâçÁôªÈå≤„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ\n\nÊ≠£Âºè„É™„É™„Éº„Çπ„ÇíÊ•Ω„Åó„Åø„Å´„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ„ÄÇ\n\n- GaiaProtocolÈñãÁô∫„ÉÅ„Éº„É†`,
                          }),
                        });
                        result.innerText = "üéâ ÂÆå‰∫ÜÔºÅ„É°„Éº„É´„ÇíÈÄÅ‰ø°„Åó„Åæ„Åó„Åü„ÄÇ";
                        document.getElementById("registerForm").reset();
                      } catch (err) {
                        result.innerText =
                          "‚ö†Ô∏è ÁôªÈå≤ÊàêÂäü„Åó„Åæ„Åó„Åü„Åå„ÄÅ„É°„Éº„É´ÈÄÅ‰ø°„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ";
                      }
                    },
                    function (error) {
                      console.error(error);
                      result.innerText = "‚ö†Ô∏è „Éá„Éº„Çø‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ";
                    }
                  );
                },
                function (error) {
                  console.error(error);
                  result.innerText = "‚ö†Ô∏è „É≠„Ç∞„Ç§„É≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ";
                }
              );
            },
            function (error) {
              console.error(error);
              result.innerText =
                "‚ö†Ô∏è ÁôªÈå≤„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: " +
                (error?.errorMessage || "‰∏çÊòé„Å™„Ç®„É©„Éº");
            }
          );
        });
    </script>
  </body>
</html>
