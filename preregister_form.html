<!DOCTYPE html>
<html lang="ja">
  <head>
    <script src="https://download.playfab.com/PlayFab.js"></script>
    <script src="https://download.playfab.com/PlayFabClientApi.js"></script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>äº‹å‰ç™»éŒ² - GaiaProtocol</title>
    <style>
      body {
        font-family: "Segoe UI", sans-serif;
        background: radial-gradient(circle at center, #030787, #000);
        color: #fff;
        text-align: center;
        padding: 30px;
      }

      h1 {
        margin-bottom: 10px;
        color: #88f7ff;
      }

      p {
        color: #ccc;
        margin-bottom: 20px;
      }

      form {
        background: rgba(255, 255, 255, 0.05);
        padding: 25px;
        border-radius: 10px;
        display: inline-block;
        text-align: left;
        width: 300px;
      }

      .terms-wrap {
        background: rgba(255, 255, 255, 0.08);
        padding: 15px;
        margin: 20px auto;
        border-radius: 8px;
        width: 85%;
        max-width: 400px;
        text-align: left;
      }

      #termsBox, #privacyBox {
        height: 150px;
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border-radius: 5px;
        color: #ccc;
        font-size: 0.9rem;
      }

      .terms-actions {
        font-size: 0.8rem;
        margin-top: 5px;
        color: #aaa;
      }

      input[type="checkbox"] {
        margin-right: 5px;
      }

      input {
        width: 100%;
        padding: 10px;
        margin-top: 10px;
        border: none;
        border-radius: 5px;
        outline: none;
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
        font-size: 15px;
      }

      input::placeholder {
        color: #aaa;
      }

      button {
        background: linear-gradient(90deg, #00c3ff, #0078ff);
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 15px;
        width: 100%;
      }

      button:hover {
        background: linear-gradient(90deg, #00eaff, #0090ff);
      }

      footer {
        margin-top: 50px;
        color: #555;
      }

      @media screen and (max-width: 600px) {
        form {
          width: 85%;
        }
      }
    </style>
  </head>

  <body>
    <main>
      <h1>ã‚¢ã‚«ã‚¦ãƒ³ãƒˆäº‹å‰ç™»éŒ²</h1>
      <p>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</p>

      <!-- åˆ©ç”¨è¦ç´„ -->
      <section class="terms-wrap">
        <h2>åˆ©ç”¨è¦ç´„</h2>
        <div id="termsBox">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="terms-actions">
          <small>æœ€å¾Œã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨åŒæ„ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚ï¼
            <a href="åˆ©ç”¨è¦ç´„.txt" download>åˆ©ç”¨è¦ç´„ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
          </small>
        </div>
        <label><input type="checkbox" id="agreeTerms" disabled />åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¾ã™</label>
      </section>

      <!-- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ -->
      <section class="terms-wrap">
        <h2>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼</h2>
        <div id="privacyBox">èª­ã¿è¾¼ã¿ä¸­...</div>
        <div class="terms-actions">
          <small>æœ€å¾Œã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨åŒæ„ãƒã‚§ãƒƒã‚¯ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚ï¼
            <a href="policy.txt" download>ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
          </small>
        </div>
        <label><input type="checkbox" id="agreePrivacy" disabled />ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«åŒæ„ã—ã¾ã™</label>
      </section>
      
      <form id="registerForm">
        <input type="email" id="email" placeholder="ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹" required disabled/><br />
        <input type="text" id="username" placeholder="ãƒ¦ãƒ¼ã‚¶ãƒ¼å" required disabled/><br />
        <input type="password" id="password" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆ6æ–‡å­—ä»¥ä¸Šï¼‰" required disabled/><br />
        <input type="password" id="confirmPassword" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªç”¨ï¼‰" required disabled/><br />
        <button type="submit" id="registerButton" disabled>ç™»éŒ²ã™ã‚‹</button>
        <p id="formNote" style="color:#aaa; margin-top:10px; margin-bottom:0;">
          ã™ã¹ã¦ã®è¦ç´„ã«åŒæ„ã™ã‚‹ã¨å…¥åŠ›ã§ãã¾ã™
        </p>
      </form>

      <p id="result" style="margin-top: 30px; color: #f0a500"></p>
    </main>

    <footer>
      <p>Â© 2025 GaiaProtocol</p>
    </footer>

    <script>
      const titleId = "1FEC7E";
      const web3formsKey = "96cfe88e-9989-49d8-b3b7-3c4d88fb821c";
      PlayFab.settings.titleId = titleId;

      window.onload = () => {
        const form = document.getElementById("registerForm");
        const result = document.getElementById("result");
        const termsBox = document.getElementById("termsBox");
        const privacyBox = document.getElementById("privacyBox");
        const agreeTerms = document.getElementById("agreeTerms");
        const agreePrivacy = document.getElementById("agreePrivacy");
        const registerButton = document.getElementById("registerButton");
        const inputs = document.querySelectorAll("#email, #username, #password, #confirmPassword");

      // ğŸ”¹ åˆ©ç”¨è¦ç´„ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®èª­ã¿è¾¼ã¿
        
        function loadText(url, box) {
          fetch(url, { cache: "no-store" })
            .then(r => r.ok ? r.text() : Promise.reject("èª­ã¿è¾¼ã¿å¤±æ•—"))
            .then(text => box.textContent = text)
            .catch(() => box.textContent = "èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        }
        loadText("åˆ©ç”¨è¦ç´„.txt", termsBox);
        loadText("policy.txt", privacyBox);
        

      // ğŸ”¹ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç¢ºèªé–¢æ•°
        function checkScrollEnd(box, checkbox) {
          const epsilon = 2;
          if (box.scrollTop + box.clientHeight >= box.scrollHeight - epsilon) {
            checkbox.disabled = false;
          }
        }

        termsBox.addEventListener("scroll", () => checkScrollEnd(termsBox, agreeTerms));
        privacyBox.addEventListener("scroll", () => checkScrollEnd(privacyBox, agreePrivacy));

      // ğŸ”¹ ä¸¡æ–¹ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸã‚‰ãƒ•ã‚©ãƒ¼ãƒ æœ‰åŠ¹åŒ–
        function updateFormState() {
          const enabled = agreeTerms.checked && agreePrivacy.checked;
          inputs.forEach(i => i.disabled = !enabled);
          registerButton.disabled = !enabled;
        }

        agreeTerms.addEventListener("change", updateFormState);
        agreePrivacy.addEventListener("change", updateFormState);

      // ğŸ”¹ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
        form.addEventListener("submit", async (e) => {
          e.preventDefault();
          result.innerText = "â³ ç™»éŒ²ä¸­...";

        if (!agree.checked) {
          result.innerText = "âš ï¸ åˆ©ç”¨è¦ç´„ã«åŒæ„ã—ã¦ãã ã•ã„ã€‚";
          return;
        }
        if (password !== confirmPassword) {
          result.innerText = "âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“ã€‚";
          return;
        }
        if (password.length < 6) {
          result.innerText = "âš ï¸ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„ã€‚";
          return;
        }

        result.innerText = "â³ ç™»éŒ²ä¸­...";

        try {
          PlayFabClientSDK.RegisterPlayFabUser(
            {
              TitleId: PlayFab.settings.titleId,
              Email: email,
              Password: password,
              Username: username,
              RequireBothUsernameAndEmail: true,
            },
            async (success) => {
              result.innerText = "âœ… ç™»éŒ²æˆåŠŸï¼ãƒ‡ãƒ¼ã‚¿ä¿å­˜ä¸­...";

              PlayFabClientSDK.UpdateUserData(
                {
                  Data: {
                    pre_registered: "true",
                    register_date: new Date().toISOString(),
                  },
                },
                async () => {
                  result.innerText = "ğŸ“§ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­...";
                  try {
                    await fetch("https://api.web3forms.com/submit", {
                      method: "POST",
                      headers: { "Content-Type": "application/json" },
                      body: JSON.stringify({
                        access_key: web3formsKey,
                        subject: "ã€GaiaProtocolé‹å–¶ã€‘äº‹å‰ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼",
                        from_name: "GaiaProtocol",
                        to: email,
                        message: `ã“ã‚“ã«ã¡ã¯ ${username} ã•ã‚“ï¼\n\nã€Gaia Protocolã€ã«äº‹å‰ç™»éŒ²ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\n\næ­£å¼ãƒªãƒªãƒ¼ã‚¹ã®ãŠçŸ¥ã‚‰ã›ã‚’æ¥½ã—ã¿ã«ãŠå¾…ã¡ãã ã•ã„ã€‚\n\n- GaiaProtocolé‹å–¶ãƒãƒ¼ãƒ `,
                      }),
                    });

                    result.innerText = "ğŸ‰ ç™»éŒ²å®Œäº†ï¼ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã«æˆ»ã‚Šã¾ã™...";
                    setTimeout(() => (location.href = "index.html"), 2000);
                  } catch (err) {
                    console.error(err);
                    result.innerText = "âš ï¸ ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                  }
                },
                (error) => {
                  console.error(error);
                  result.innerText = "âš ï¸ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
                }
              );
            },
            (error) => {
              console.error(error);
              result.innerText =
                "âš ï¸ ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ: " + (error?.errorMessage || "ä¸æ˜ãªã‚¨ãƒ©ãƒ¼");
            }
          );
        } catch (err) {
          console.error(err);
          result.innerText = "âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
        }
      });

        // ï¼ˆPlayFabç™»éŒ²å‡¦ç†ã¯ã“ã“ã«ãã®ã¾ã¾å…¥ã‚Œã¦OKï¼‰
      });
    </script>
  </body>
</html>
